<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Jogo de Interação</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        #game-container {
            width: 800px;
            height: 600px;
            background-color: #e0e0e0;
            position: relative;
            overflow: hidden;
        }
        #player {
            width: 50px;
            height: 50px;
            background-color: blue;
            position: absolute;
            bottom: 100px;
        }
        #npc {
            width: 70px;
            height: 70px;
            background-color: green;
            position: absolute;
            right: 100px;
            bottom: 100px;
        }
        #ground {
            width: 100%;
            height: 100px;
            background-color: brown;
            position: absolute;
            bottom: 0;
        }
        #dialog-box {
            width: 100%;
            height: 100px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            position: absolute;
            bottom: 0;
            display: none;
            padding: 10px;
            box-sizing: border-box;
        }
        #reputation-bar {
            width: 300px;
            height: 20px;
            background-color: gray;
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        #reputation-indicator {
            width: 50%;
            height: 100%;
            background-color: gray;
        }
        .choice-button {
            margin: 5px;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="ground"></div>
        <div id="player"></div>
        <div id="npc"></div>
        <div id="reputation-bar">
            <div id="reputation-indicator"></div>
        </div>
        <div id="dialog-box">
            <p id="dialog-text"></p>
            <div id="choice-container"></div>
        </div>
    </div>

    <script>
        const player = document.getElementById('player');
        const npc = document.getElementById('npc');
        const dialogBox = document.getElementById('dialog-box');
        const dialogText = document.getElementById('dialog-text');
        const choiceContainer = document.getElementById('choice-container');
        const reputationIndicator = document.getElementById('reputation-indicator');

        let reputation = 0;
        let dialogStage = 0;

        const dialogs = [
            {
                text: "Olá! Preciso da sua ajuda.",
                choices: [
                    { text: "Claro, no que posso ajudar?", effect: 1 },
                    { text: "Estou ocupado agora.", effect: -1 }
                ]
            },
            {
                text: "Encontrei algo valioso, mas não sei o que fazer.",
                choices: [
                    { text: "Devemos devolver ao dono.", effect: 1 },
                    { text: "Podemos ficar com isso.", effect: -1 }
                ]
            }
        ];

        document.addEventListener('keydown', (e) => {
            const step = 10;
            switch(e.key) {
                case 'a': player.style.left = `${player.offsetLeft - step}px`; break;
                case 'd': player.style.left = `${player.offsetLeft + step}px`; break;
                case 'w': player.style.bottom = `${parseInt(player.style.bottom || '100') + step}px`; break;
                case 's': player.style.bottom = `${parseInt(player.style.bottom || '100') - step}px`; break;
                case 'e': interactWithNPC(); break;
            }
        });

        function interactWithNPC() {
            if (player.offsetLeft >= npc.offsetLeft - 50 && player.offsetLeft <= npc.offsetLeft + 50) {
                showDialog();
            }
        }

        function showDialog() {
            if (dialogStage < dialogs.length) {
                dialogBox.style.display = 'block';
                dialogText.textContent = dialogs[dialogStage].text;
                
                choiceContainer.innerHTML = '';
                dialogs[dialogStage].choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.textContent = choice.text;
                    button.classList.add('choice-button');
                    button.onclick = () => handleChoice(choice.effect);
                    choiceContainer.appendChild(button);
                });
            } else {
                endGame();
            }
        }

        function handleChoice(effect) {
            reputation += effect;
            updateReputationBar();
            dialogStage++;
            dialogBox.style.display = 'none';
        }

        function updateReputationBar() {
            const maxReputation = 10;
            const percent = ((reputation + maxReputation) / (2 * maxReputation)) * 100;
            reputationIndicator.style.width = `${percent}%`;
            
            if (reputation > 0) {
                reputationIndicator.style.backgroundColor = 'blue';
            } else if (reputation < 0) {
                reputationIndicator.style.backgroundColor = 'red';
            } else {
                reputationIndicator.style.backgroundColor = 'gray';
            }
        }

        function endGame() {
            fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer SUA_CHAVE_API'
                },
                body: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    messages: [
                        {role: "system", content: "Analise as escolhas do jogador e sugira as melhores opções baseadas em ética e consequências."},
                        {role: "user", content: `Reputação final: ${reputation}`}
                    ]
                })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.choices[0].message.content);
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Não foi possível consultar a IA.');
            });
        }
    </script>
</body>
</html>