<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>RPG Interativo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        #game-container {
            width: 2400px;
            height: 100vh;
            position: relative;
            overflow: hidden;
            background: url('fundo.jpg') repeat-x;  
            background-size: auto 100%;
        }

        #viewport {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        #game-world {
            width: 2400px;
            height: 100vh;
            position: absolute;
            left: 0;
            transition: left 0.3s ease;
        }

        #player {
            width: 50px;
            height: 50px;
            background: url('bonecoTeste.png') no-repeat center center;
            background-size: contain;
            position: absolute;
            bottom: 100px;
            left: 100px;
            z-index: 2;
            transition: transform 0.1s;
        }

        .flip {
            transform: scaleX(-1);
        }

        .npc {
            width: 70px;
            height: 70px;
            position: absolute;
            bottom: 100px;
            z-index: 1;
            background-color: #00CED1;
            transition: transform 0.3s;
        }

        .structure {
            position: absolute;
            bottom: 100px;
            z-index: 1;
            transition: transform 0.3s;
        }

        #ground {
            width: 100%;
            height: 100px;
            background-color: rgba(78, 250, 10, 0.7);
            position: absolute;
            bottom: 0;
        }

        #dialog-box {
            width: 80vw;
            max-width: 800px;
            background-color: rgba(0,0,0,0.9);
            color: white;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            padding: 20px;
            border-radius: 10px;
            z-index: 3;
            font-size: 18px;
        }

        #reputation-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 4;
            background-color: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            color: white;
        }

        #reputation-bar {
            width: 200px;
            height: 20px;
            background-color: #4287f5;
            margin-top: 5px;
            border-radius: 10px;
            overflow: hidden;
        }

        #reputation-indicator {
            width: 50%;
            height: 100%;
            background-color: white;
            transition: width 0.3s ease;
        }

        .choice-button {
            margin: 8px;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .choice-button:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }

        #controls-hint {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }

        #inventory-button {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="viewport">
        <div id="controls-hint">
            Controles:<br>
            A/← - Mover para esquerda<br>
            D/→ - Mover para direita<br>
            E/Enter - Interagir
        </div>
        <div id="reputation-container">
            <div>Reputação</div>
            <div id="reputation-bar">
                <div id="reputation-indicator"></div>
            </div>
        </div>
        <button id="inventory-button">Inventário</button>
        <div id="game-container">
            <div id="game-world">
                <div id="ground"></div>
                <div id="player"></div>
            </div>
        </div>
        <div id="dialog-box">
            <p id="dialog-text"></p>
            <div id="choice-container"></div>
        </div>
    </div>

    <script>
        const player = document.getElementById('player');
        const dialogBox = document.getElementById('dialog-box');
        const dialogText = document.getElementById('dialog-text');
        const choiceContainer = document.getElementById('choice-container');
        const reputationIndicator = document.getElementById('reputation-indicator');
        const gameWorld = document.getElementById('game-world');
        const viewport = document.getElementById('viewport');
        const gameContainer = document.getElementById('game-container');

        let playerX = 100;
        let worldX = 0;
        let reputation = 0;
        let isDialogActive = false;
        let currentNPC = null;
        let playerSpeed = 5; // Velocidade reduzida para movimento mais suave

        const npcs = [
            {
                id: 'merchant',
                x: 300,
                type: 'Mercador'
            },
            {
                id: 'quest_giver',
                x: 800,
                type: 'Aldeão'
            },
            {
                id: 'wizard',
                x: 1500,
                type: 'Mago'
            }
        ];

        const structures = [
            { x: 500, width: 100, height: 150, color: 'rgba(139, 69, 19, 0.7)', type: 'house' },
            { x: 1200, width: 150, height: 200, color: 'rgba(74, 74, 74, 0.7)', type: 'tower' },
            { x: 2000, width: 120, height: 180, color: 'rgba(139, 69, 19, 0.7)', type: 'inn' }
        ];

        function createWorldElements() {
            npcs.forEach(npc => {
                const npcElement = document.createElement('div');
                npcElement.className = 'npc';
                npcElement.style.left = `${npc.x}px`;
                npcElement.id = npc.id;
                gameWorld.appendChild(npcElement);
            });

            structures.forEach(structure => {
                const structureElement = document.createElement('div');
                structureElement.className = 'structure';
                structureElement.style.backgroundColor = structure.color;
                structureElement.style.width = `${structure.width}px`;
                structureElement.style.height = `${structure.height}px`;
                structureElement.style.left = `${structure.x}px`;
                gameWorld.appendChild(structureElement);
            });
        }

        createWorldElements();

        async function getNPCDialog(npcType) {
            // Diálogos específicos para cada NPC
            const dialogs = {
                'Mercador': {
                    text: "Olá viajante! Tenho ótimas mercadorias para vender. Está interessado?",
                    choices: [
                        { text: "Claro! Mostre-me o que tem (Amigável)", effect: 1 },
                        { text: "Seus preços são muito altos! (Hostil)", effect: -1 }
                    ]
                },
                'Aldeão': {
                    text: "Por favor, preciso de ajuda! Nosso vilarejo está com problemas...",
                    choices: [
                        { text: "Como posso ajudar? (Prestativo)", effect: 1 },
                        { text: "Não tenho tempo para isso. (Indiferente)", effect: -1 }
                    ]
                },
                'Mago': {
                    text: "Ah, um aventureiro! Busca conhecimento mágico?",
                    choices: [
                        { text: "Sim, mestre! Desejo aprender. (Respeitoso)", effect: 1 },
                        { text: "Magia é perda de tempo! (Desrespeitoso)", effect: -1 }
                    ]
                }
            };
            
            return dialogs[npcType] || {
                text: `[Diálogo padrão do ${npcType}]`,
                choices: [
                    { text: "Opção 1 (Boa)", effect: 1 },
                    { text: "Opção 2 (Ruim)", effect: -1 }
                ]
            };
        }

        let keys = {
            left: false,
            right: false
        };

        document.addEventListener('keydown', (e) => {
            if (isDialogActive) return;

            if (e.key === 'a' || e.key === 'ArrowLeft') keys.left = true;
            if (e.key === 'd' || e.key === 'ArrowRight') keys.right = true;
            if (e.key === 'e' || e.key === 'Enter') checkInteraction();
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'a' || e.key === 'ArrowLeft') keys.left = false;
            if (e.key === 'd' || e.key === 'ArrowRight') keys.right = false;
        });

        function gameLoop() {
            if (!isDialogActive) {
                if (keys.left) {
                    playerX = Math.max(50, playerX - playerSpeed);
                    player.classList.remove('flip');
                }
                if (keys.right) {
                    playerX = Math.min(2350, playerX + playerSpeed);
                    player.classList.add('flip');
                }

                player.style.left = `${playerX}px`;

                // Atualiza a posição do mundo apenas quando o jogador está além do centro
                const viewportWidth = viewport.clientWidth;
                const halfViewport = viewportWidth / 2;

                if (playerX > halfViewport && playerX < 2400 - halfViewport) {
                    worldX = -1 * (playerX - halfViewport);
                    gameWorld.style.left = `${worldX}px`;
                    gameContainer.style.backgroundPosition = `${worldX * 0.5}px 0`;
                }
            }
            requestAnimationFrame(gameLoop);
        }

        gameLoop();

        async function checkInteraction() {
            for (const npc of npcs) {
                const npcElement = document.getElementById(npc.id);
                const npcRect = npcElement.getBoundingClientRect();
                const playerRect = player.getBoundingClientRect();
                
                if (Math.abs(npcRect.left - playerRect.left) < 100) {
                    currentNPC = npc;
                    const dialog = await getNPCDialog(npc.type);
                    showDialog(dialog);
                    return;
                }
            }
        }

        function showDialog(dialog) {
            isDialogActive = true;
            dialogBox.style.display = 'block';
            dialogText.textContent = dialog.text;
            
            choiceContainer.innerHTML = '';
            dialog.choices.forEach(choice => {
                const button = document.createElement('button');
                button.textContent = choice.text;
                button.classList.add('choice-button');
                button.onclick = () => handleChoice(choice);
                choiceContainer.appendChild(button);
            });
        }

        function handleChoice(choice) {
            reputation += choice.effect;
            updateReputationBar();
            
            isDialogActive = false;
            dialogBox.style.display = 'none';
            currentNPC = null;
        }

        function updateReputationBar() {
            const maxReputation = 10;
            const percent = ((reputation + maxReputation) / (2 * maxReputation)) * 100;
            reputationIndicator.style.width = `${percent}%`;
        }

    </script>
</body>
</html>